---
title: Install Weave GitOps Enterprise via CLI
hide_title: true
toc_max_heading_level: 4
---

import TierLabel from "../../_components/TierLabel";

# Install Weave GitOps Enterprise via CLI

## Prerequisites

#### Git Repository

To be used as the repository of the WeaveGitOps Enterprise repo.

#### Flux Installed Locally (binary)

To be used in reconciling sources, Kustomizations, HelmReleases

#### Kubectl binary

To be used in port-forwarding

#### A Kubernetes Cluster

To install weave gitops enterprise. We also require a kubeconfig with admin permissions to create resources.

#### Entitlments File

To get the entitlement secret please contact *sales@weave.works*, then apply it on your management cluster with the name `weave-gitops-enterprise-credentials` under `flux-system` namespace. 

#### Flux bootstrapped via SSH

To boostrap Weave Gitops we require flux to be bootstrapped using the configuration repo specified earlier via SSH [here](https://fluxcd.io/flux/cmd/flux_bootstrap_git/)

#### SSH private key for Git Repo 

Bootstrap command writes manifests to the git repo via ssh.

#### [Phase 1] Flux on Management Cluster 

On the management cluster, Flux (>v1.x.x) needs to be installed on the management cluster. There are different ways to bootstrap flux on your Kubernetes clusters, please follow the instructions found on flux bootstrap documentation [here](https://fluxcd.io/flux/installation/bootstrap/)

#### [Phase 2] Flux on Management Cluster (Optional)

If your cluster doesn’t have flux installed on the management cluster, `gitops-ee bootstrap` offer a way to bootstrap flux using the git generic approach. If you need more tailored or advanced configurations for the installed flux binary installed on your cluster, please follow the instructions found on flux bootstrap documentation [here](https://fluxcd.io/flux/installation/bootstrap/).  

#### `gitops-ee` CLI v.?.?

Weave GitOps Enterprise Bootstrap functionality is available on Weave GitOps Enterprise CLI starting from version x.x.x. Use the following command to install the latest `gitops-ee` CLI.
`brew install weaveworks/tap/gitops-ee`

## Installing Weave GitOps Enterprise via CLI

Please use the following command to start the installation wizard of Weave GitOps Enterprise.

```bash
gitops-ee bootstrap
```

The bootstrap wizard will take you step-by-step into configuring Weave GitOps Enterprise. To understand more about the CLI configurations experience, check the below sections [here](#cli-configurations). 

## Understanding `gitops-ee bootstrap`

### Overview

`gitops-ee bootstrap` command is a wizard-like command line that helps you to install Weave GitOps Enterprise on their management cluster by guiding them step by step to configure it. 

The following are the steps the wizard will take you through it.

1. [Verifying Entitlement](#verifying-entitlement): Verify entitlement secret content (username, password, entitlement)
2. [Verifying flux](#verifying-flux): Verify flux installation on management cluster
3. [Adding private key path and private key password](#adding-private-key-path-and-private-key-password): to push WGE resources to the cluster's repository
4. [Selecting WGE version](#selecting-wge-version): from the latest 3 available releases
5. [Create admin credentials](#create-admin-credentials): create admin secret with username and password to be able to access the dashboard
6. [Select the domain](#select-the-domain): choose between 2 methods to access the dashboard either locally or via external domain
7. [Configure OIDC](#configure-oidc): to enable login to dashboard via OIDC providers.
8. [Access the dashboard](#access-the-dashboard): via the link from the installation success message

### Verifying Entitlement

Weave GitOps Enterprise Entitlement is your obtained license to use our product. The entitlement file is a kubernetes secret that contains your licence. The bootstrap CLI will check if the entitlement manifest exists on the management cluster, and it will check if it has valid content and the entitlement is not expired. 
To get the entitlement secret please contact *sales@weave.works*, then apply it on your management cluster with the name `weave-gitops-enterprise-credentials` under `flux-system` namespace. 

### Verifying flux

Weave GitOps Enterprise runs on top of flux, the bootstrap CLI will check if flux is installed on the management cluster, and it will verify that it has the right version with valid git repository setup, and it is able to reconcile flux components properly. 
If flux is installed, but doesn't have a valid installation, the bootstrap CLI will terminate pending the fix or uninstall of current flux installation.
If flux is not installed at all, the bootstrap CLI offers the option to bootstrap flux. 

### Adding private key path and private key password

Private key will be used to push WGE resources to the cluster's git repository.
Priave key password is not optional if the private key is encrypted with it

### Selecting WGE version

The bootstrap CLI will prompt you to choose from the latest 3 versions of Weave GitOps Enterprise.

### Create admin credentials

Creates admin secret with username and password to be able to access the dashboard. If you already have previous admin credentials on your cluster, the installation will prompt you if you want to continue with the old credentials or exit and revoke them and re-run the installation.

### Select the domain

choose between 2 methods to access the dashboard either locally or via external domain
Localhost can be useful in air-gapped environments or testing on local-host
External Domain will provide you with a domain to access your dashboard UI.

#### External DNS

[External DNS](https://github.com/kubernetes-sigs/external-dns) for Kubernetes is a tool that automates the management of external DNS records.
It allows Kubernetes services to be exposed to the internet with a DNS entry that corresponds to the service's name.

There are several implementations of External DNS available with specific DNS providers (e.g., AWS Route 53, Google Cloud DNS, Azure DNS, etc.).

Some popular implementations include:
- kube-dns: Integrates with CoreDNS and is a common choice for Kubernetes clusters.
- AWS Route 53 External DNS: Specifically for AWS Route 53.
- GCP External DNS: For Google Cloud DNS.
- Azure External DNS: For Azure DNS.

Learn how to deploy External DNS into your cluster [here](https://github.com/kubernetes-sigs/external-dns?tab=readme-ov-file#deploying-to-a-cluster)

[Full tutorial to use External DNS with AWS Route 53](https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.5/guide/integrations/external_dns/)

After configuring your provider to use ExternalDNS, The following example is a follow-up on the previous tutorial is the manifests that need to be deployed to the cluster with the following structure:

<details><summary>Expand to see the files structure</summary>

```bash
.
├── cluster-role-binding.yaml
├── cluster-role.yaml
├── deployment.yaml
├── kustomization.yaml
├── ingress-nginx.yaml
└── namespace.yaml
```

</details>

1- Kustomization file

<details><summary>Expand to see example Kustomization file content</summary>

```yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- namespace.yaml
- deployment.yaml
- cluster-role.yaml
- cluster-role-binding.yaml
- ingress-nginx.yaml
```
</details>

2- Namespace: `external-dns`

<details><summary>Expand to see example `namespace.yaml` file content</summary>

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: external-dns
```
</details>

3- ClusterRole

<details><summary>Expand to see example `cluster-role.yaml` file content</summary>

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: external-dns
  labels:
    app.kubernetes.io/name: external-dns
rules:
  - apiGroups: [""]
    resources: ["services","endpoints","pods","nodes"]
    verbs: ["get","watch","list"]
  - apiGroups: ["extensions","networking.k8s.io"]
    resources: ["ingresses"]
    verbs: ["get","watch","list"]
```

</details>

4- ClusterRoleBinding

<details><summary>Expand to see example `cluster-role-binding.yaml` file content</summary>

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: external-dns-viewer
  labels:
    app.kubernetes.io/name: external-dns
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: external-dns
subjects:
  - kind: ServiceAccount
    name: external-dns
    namespace: external-dns
```

</details>

5- External DNS Deployment

<details><summary>Expand to see example `deployment.yaml` file content</summary>

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: external-dns
  namespace: external-dns
  labels:
    app.kubernetes.io/name: external-dns
spec:
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app.kubernetes.io/name: external-dns
  template:
    metadata:
      labels:
        app.kubernetes.io/name: external-dns
    spec:
      serviceAccountName: external-dns
      containers:
        - name: external-dns
          image: k8s.gcr.io/external-dns/external-dns:v0.11.0
          args:
            - --source=service
            - --source=ingress
            - --domain-filter=<domain-name> # will make ExternalDNS see only the hosted zones matching provided domain, omit to process all available hosted zones. example (mydomain.com)
            - --provider=aws
            - --policy=sync # would allow ExternalDNS to delete records, use upsert-only to prevent ExternalDNS from deleting any records
            - --aws-zone-type=public # only look at public hosted zones (valid values are public, private or no value for both)
            - --registry=txt
            - --txt-owner-id=cluster-${CLUSTER_NAME}
          env:
            - name: AWS_DEFAULT_REGION
              value: <aws-region> # select the default aws-region (example: eu-north-1)
```

</details>

6- Ingress-nginx

<details><summary>Expand to see example `ingress-nginx.yaml` file content</summary>

```yaml
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: HelmRepository
metadata:
  name: ingress-nginx
  namespace: flux-system
spec:
  interval: 1m0s
  timeout: 1m0s
  url: "https://kubernetes.github.io/ingress-nginx"
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  labels:
    weave.works/applied-layer: layer-1
  name: ingress-nginx
  namespace: flux-system
spec:
  chart:
    spec:
      chart: ingress-nginx
      sourceRef:
        apiVersion: source.toolkit.fluxcd.io/v1beta2
        kind: HelmRepository
        name: ingress-nginx
        namespace: flux-system
      version: 4.2.5
  install:
    crds: CreateReplace
    createNamespace: true
  interval: 1m0s
  targetNamespace: flux-system
  upgrade:
    crds: CreateReplace
  values:
    controller:
      ingressClassResource:
        enabled: true
        name: public-nginx
        default: false
        controllerValue: "k8s.io/public-ingress-nginx"
      ingressClass: public-nginx
      service:
        annotations:
          service.beta.kubernetes.io/aws-load-balancer-ssl-cert: ${SSL_CERTIFICATE_ARN}
          service.beta.kubernetes.io/aws-load-balancer-type: nlb
          service.beta.kubernetes.io/aws-load-balancer-internal: "false"
        targetPorts:
          http: http
          https: http
```

</details>

The corresponding Ingress configurations in WGE helmrelease that will be generated is like the following:

<details><summary>Expand to see ingress configurations</summary>

```yaml
ingress:
    annotations:
    external-dns.alpha.kubernetes.io/hostname: mydomain.com
    className: public-nginx
    enabled: true
    hosts:
    - host: mydomain.com
    paths:
    - path: /
        pathType: ImplementationSpecific
```

</details>


### Configure OIDC

OIDC configuration will enable you to login with OIDC provider beside admin credentials.
Add your OIDC `DiscoveryUrl` this will verify that OIDC is accessible and get the issuerUrl from the OIDC settings.
Then add the `clientID` & `clientSecret` that you have configured on your OIDC static-clients.
Note: don't forget to add a new static-client on your OIDC provider settings with the redirectURI `your-domain/oauth2/callback` for example `http://localhost:3000/oauth2/callback`
Also you can configure the OIDC later by running the following command `bootstrap auth --type=oidc`

### Access the dashboard

Via the link from the installation success message

## Appendix

### CLI configurations

- `--kube-config`:                  allows to choose the kubeconfig for your cluster, default would be ~/.kube/config
- `-d`, `--domain externaldns`:     indicate the domain to use in case of using externaldns
- `-t`, `--domain-type`:            dashboard domain type: could be 'localhost' or 'externaldns'
- `-h`, `--help`:                   help for bootstrap
- `-p`, `--password`:               Dashboard admin password
- `-k`, `--private-key`:            Private key path. This key will be used to push the Weave GitOps Enterprise's resources to the default cluster repository
- `-c`, `--private-key-password`:   Private key password. If the private key is encrypted using password
- `-u`, `--username`:               Dashboard admin username
- `-v`, `--version`:                Weave GitOps Enterprise version to install
