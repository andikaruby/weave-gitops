---
title: TLS and Certificates
---

## TLS Configuration

By default Weave GitOps Dashboard listens on 0.0.0.0:9001 with TLS disabled and
without exposing any external connection.

Exposing services without TLS if not recommended. Without a certificate, a user
can't be sure they are using the right service, and the traffic will be easily
monitored, or even tampered with. All communication between the user and an endpoint
with TLS will be encrypted.

To expose an external connection, you must first configure TLS. TLS termination
can be provided via an ingress controller or directly by the dashboard. In
either case, the Helm Release must be updated. To have the dashboard itself
handle TLS, you must create a `tls` secret containing the cert and key:

```cli
kubectl create secret tls my-tls-secret \
  --cert=path/to/cert/file \
  --key=path/to/key/file
```

and reference it from the helm release:

```yaml
  values:
    serverTLS:
      enabled: true
      secretName: "my-tls-secret"
```

If you prefer to delegate TLS handling to the ingress controller instead, your
helm release should look like:

```yaml
  values:
    ingress:
      enabled: true
      ... other parameters specific to the ingress type ...
```
## cert-manager

You can install [cert-manager](https://cert-manager.io/) to issue and automatically manage certificates in Kubernetes and OpenShift clusters, and to request a `Certificate` in
the `flux-system` namespace. cert-manager is a CNCF project. 

### Install cert-manager

As cert-manager can be installed using a [Helm Chart](https://cert-manager.io/docs/installation/helm/), we can
simply create a `HelmRepository` and a `HelmRelease` to have Flux install everything.

Commit the following to a location being reconciled by Flux.

<details><summary>Expand to see manifest contents</summary>

```yaml
---
apiVersion: v1
kind: Namespace
metadata:
  name: cert-manager
---
apiVersion: source.toolkit.fluxcd.io/v1beta1
kind: HelmRepository
metadata:
  name: cert-manager
  namespace: cert-manager
spec:
  interval: 1h
  url: https://charts.jetstack.io
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: cert-manager
  namespace: cert-manager
spec:
  interval: 5m
  chart:
    spec:
      chart: cert-manager
      version: 1.8.0
      sourceRef:
        kind: HelmRepository
        name: cert-manager
        namespace: cert-manager
      interval: 1m
  values:
    installCRDs: true
```

</details>

:::note cert-manager version
At time of writing, cert manager v1.8.0 was the latest available release and a newer version may exist, please
ensure to check <https://github.com/cert-manager/cert-manager/tags> for updates.
:::

Now that `cert-manager` is running, we can create a `ClusterIssuer` to represent the certificate authority
from which we will obtain signed certificates, in this example we are using Let's Encrypt. After changing
the email address, commit this to the same location as above.

<details><summary>Expand to see manifest contents</summary>

```yaml
---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    # You must replace this email address with your own.
    # Let's Encrypt will use this to contact you about expiring
    # certificates, and issues related to your account.
    email: weave-gitops@example.tld
    server: https://acme-v02.api.letsencrypt.org/directory
    privateKeySecretRef:
      # Secret resource that will be used to store the account's private key.
      name: letsencrypt-prod-account-key
    solvers:
    # Add a single challenge solver, HTTP01 using nginx
    - http01:
       ingress:
         class: nginx
```

</details>

Once this `ClusterIssuer` resource is installed, the cluster is now configured to request and use certificates generated by cert-manager.
